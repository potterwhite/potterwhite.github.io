<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-cn" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="http://localhost:1313/blog/011_windows_development/">
<link rel="alternate" type="application/rss&#43;xml" href="http://localhost:1313/blog/011_windows_development/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>011_Grp_Windows | 嵌入式系统 Enthusiast</title>
<meta name="description" content="First of All, I am a pure christian. Husband of my wife Father of my daughters Enthusiast of Embedded System, Linux/Docker/ERP/WASAPI/NodeJS/SockerIO/">
<meta property="og:url" content="http://localhost:1313/blog/011_windows_development/">
  <meta property="og:site_name" content="嵌入式系统 Enthusiast">
  <meta property="og:title" content="011_Grp_Windows">
  <meta property="og:description" content="First of All, I am a pure christian. Husband of my wife Father of my daughters Enthusiast of Embedded System, Linux/Docker/ERP/WASAPI/NodeJS/SockerIO/">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="011_Grp_Windows">
  <meta itemprop="description" content="First of All, I am a pure christian. Husband of my wife Father of my daughters Enthusiast of Embedded System, Linux/Docker/ERP/WASAPI/NodeJS/SockerIO/">
  <meta itemprop="datePublished" content="2024-10-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-10-10T00:00:00+00:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="011_Grp_Windows">
  <meta name="twitter:description" content="First of All, I am a pure christian. Husband of my wife Father of my daughters Enthusiast of Embedded System, Linux/Docker/ERP/WASAPI/NodeJS/SockerIO/">
<link href="/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

  </head>
  <body class="td-section td-blog">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg width="30" height="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100%" height="100%" fill="none"/><text x="50%" y="50%" font-family="Times New Roman" font-weight="bold" font-size="80" text-anchor="middle" fill="#fff" dy=".35em">J</text></svg></span><span class="navbar-brand__name">嵌入式系统 Enthusiast</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/project/"><span>我的项目</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/news/"><span>News</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/blog/"><span>博客文章</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="站内搜索…"
    aria-label="站内搜索…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="25"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href="#" onclick="print();return false;">点击此处打印</a>.
</p><p>
<a href="/blog/011_windows_development/">返回本页常规视图</a>.
</p>
</div>



<h1 class="title">011_Grp_Windows</h1>





    <ul>
    
  
  
  
  

  
    
    
	

    <li><a href="#pg-0fc815991af709e0d45b6ac0f2e0a676">IMMNotificationClient Callback Problem</a></li>



    
  
    
    
	

    <li><a href="#pg-4b40b8f3a9fde137d7b53e3793fc482c">ASIO</a></li>



    
  
    
    
	

    <li><a href="#pg-5637ca4afd986b1e0d9ae4793487f985">声卡项目</a></li>



    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    


  

<div class="td-content" style="">
    <h1 id="pg-0fc815991af709e0d45b6ac0f2e0a676">IMMNotificationClient Callback Problem</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2024-10-10" class="text-body-secondary">2024年10月10日</time>
        
	</div>
	<!-- <iframe src="/2024/October/IMNotificationClient_Callback.svg" width="1900" height="5000" style="border:none; overflow:scroll; background: #333333;"></iframe> -->
<p><a href="https://mermaid.live/edit#pako:eNqVVm1T2lgU_ivZfHTQIYhgcdoZi6i03fq225ltcDIBAmQbEhZuutaXGbS-gFCx6jpWq67bWt3uFnWcWsUXfsxyE_jkX9iTBFlEd9mSGYbce85znjz3nCeMkD7Jz5EOMiBIP_tCbBQR33V4RAI-MdkbjLKREKFsTJbiv-KZc-WX_fYBJxKYngiKeUQP0q77tLuJcEY5FnFEmIm0y35eckoiikoCcZdwDSHG2KzeuDxbw4k1fJrrbn-EDybU1Um8d1I82BrUQLXa94nGxnuEk3YDdoyJuMUYYkUfB4AoxMcuz9Kl9TdKfFxJzOPXKzizUprJFPLr-NMKPl_EyVe9OurB6U1gpw7cAcCAzAduMP7mLiHKghBB0TYCJ94ry59qKCore3j-g8FeKz-7WcHu0LBHH48SXdT1pR9GCRftftJUW63xniaPW-QRM8AhxiX6eyVeRMxjCfEB3sciXhIZJysIXtb3TNdsHe-kcHoZOIEGxeyFep4txVfVzW2N39pGcf-lcUyF45yhhCHCNbX0gBjjeg5VBQnFKnUHEIvkmDPEikHO_1d8oqFBOdxVJjPqxAmllcu_KRx_vAmF9w9AFKBUOJ7rfVTMrxW30kCqkN_SSE1t48w7QGhoqOjk0s-gkwZBivkNZW4bQnHmC15IKzvnl2er__SYw-Ed4IO3E-yMSmEoSgBUdUKdx6qQ6NRJdNFPoA-Y7yN-6NCrBLcYkNqUZArP7hbnvuDM8tVGDB4IuCrjexWYLop2CwIXZAWCG-JReZ0T_cYMtdOVMyutHCnZz4N62X-bKC3l9j2DrYVWPyXxxZS69Wfh9KiQS8H3oJHWZdFDuunqPZx5rS5tXp4lChcp_GFCO8T4ofI2p2QW4GAuz5Ll5G49101reirv4srnFE7sX4N36xEP9AjoMnVpF3oDT6dr-o6oL7-G9kBHe0hXH1zdjiRutl7xtz-U5A70Wxn3oY5bF6nG3_5HvGF1HuSiaMMVqkzJcITS-ob6e844_3KbU1d-MEzdXNY8wUJ7JfAcFI4wUSSCufV9yyG2x_sj50MOBy8-l55xsBKSqhjcdpWRcWYCNIFRXa1iZyK-ItcCuXUnzmTI998fA68Z8PrgUfpkTub84HoiPBmY2ldAWDUIpr2_i9C0MhF8rAzD-duqDMpSMahq2QxrgjdDcW9czeXV3RTOJvHUrm5Mh6WlrLL4qnD-FryucLKpnWP2pTI7W3HOsuMn48a7pcZIlfRMaSEB6ZrZ6lwN78PvJ9X56UJuWrfQ6o4YpmhwhlqPqN_4WlP30H2IKE_1xUd1bs8oQ9RKW56EHj2pl67vn4b5wiSBWeD9yXJ-r57fR9ejBo5dGUXDF8oAfTpAP_1TB-eVg0TxYhHP5NTZI5AP3tfghxUj1aL79eintMuQRyRNZJiLhlneD39NRrQYD4lCXJjzkA746ecCrCwgD-kRxyCUlZE08EL0kQ4UlTkTGZXkYIh0BFghBneybu4dPAvTHq6sRljxqSSFr1LglnSMkEOkw9baZG9pvUO12m0Wi9lubjaRL0hHI2WzN1ntVpvdbKXMVIvN0jJmIod1BKqp2XqHslFWq91sMTe32i1jfwO60Sce"><img src="https://mermaid.ink/img/pako:eNqVVm1T2lgU_ivZfHTQIYhgcdoZi6i03fq225ltcDIBAmQbEhZuutaXGbS-gFCx6jpWq67bWt3uFnWcWsUXfsxyE_jkX9iTBFlEd9mSGYbce85znjz3nCeMkD7Jz5EOMiBIP_tCbBQR33V4RAI-MdkbjLKREKFsTJbiv-KZc-WX_fYBJxKYngiKeUQP0q77tLuJcEY5FnFEmIm0y35eckoiikoCcZdwDSHG2KzeuDxbw4k1fJrrbn-EDybU1Um8d1I82BrUQLXa94nGxnuEk3YDdoyJuMUYYkUfB4AoxMcuz9Kl9TdKfFxJzOPXKzizUprJFPLr-NMKPl_EyVe9OurB6U1gpw7cAcCAzAduMP7mLiHKghBB0TYCJ94ry59qKCore3j-g8FeKz-7WcHu0LBHH48SXdT1pR9GCRftftJUW63xniaPW-QRM8AhxiX6eyVeRMxjCfEB3sciXhIZJysIXtb3TNdsHe-kcHoZOIEGxeyFep4txVfVzW2N39pGcf-lcUyF45yhhCHCNbX0gBjjeg5VBQnFKnUHEIvkmDPEikHO_1d8oqFBOdxVJjPqxAmllcu_KRx_vAmF9w9AFKBUOJ7rfVTMrxW30kCqkN_SSE1t48w7QGhoqOjk0s-gkwZBivkNZW4bQnHmC15IKzvnl2er__SYw-Ed4IO3E-yMSmEoSgBUdUKdx6qQ6NRJdNFPoA-Y7yN-6NCrBLcYkNqUZArP7hbnvuDM8tVGDB4IuCrjexWYLop2CwIXZAWCG-JReZ0T_cYMtdOVMyutHCnZz4N62X-bKC3l9j2DrYVWPyXxxZS69Wfh9KiQS8H3oJHWZdFDuunqPZx5rS5tXp4lChcp_GFCO8T4ofI2p2QW4GAuz5Ll5G49101reirv4srnFE7sX4N36xEP9AjoMnVpF3oDT6dr-o6oL7-G9kBHe0hXH1zdjiRutl7xtz-U5A70Wxn3oY5bF6nG3_5HvGF1HuSiaMMVqkzJcITS-ob6e844_3KbU1d-MEzdXNY8wUJ7JfAcFI4wUSSCufV9yyG2x_sj50MOBy8-l55xsBKSqhjcdpWRcWYCNIFRXa1iZyK-ItcCuXUnzmTI998fA68Z8PrgUfpkTub84HoiPBmY2ldAWDUIpr2_i9C0MhF8rAzD-duqDMpSMahq2QxrgjdDcW9czeXV3RTOJvHUrm5Mh6WlrLL4qnD-FryucLKpnWP2pTI7W3HOsuMn48a7pcZIlfRMaSEB6ZrZ6lwN78PvJ9X56UJuWrfQ6o4YpmhwhlqPqN_4WlP30H2IKE_1xUd1bs8oQ9RKW56EHj2pl67vn4b5wiSBWeD9yXJ-r57fR9ejBo5dGUXDF8oAfTpAP_1TB-eVg0TxYhHP5NTZI5AP3tfghxUj1aL79eintMuQRyRNZJiLhlneD39NRrQYD4lCXJjzkA746ecCrCwgD-kRxyCUlZE08EL0kQ4UlTkTGZXkYIh0BFghBneybu4dPAvTHq6sRljxqSSFr1LglnSMkEOkw9baZG9pvUO12m0Wi9lubjaRL0hHI2WzN1ntVpvdbKXMVIvN0jJmIod1BKqp2XqHslFWq91sMTe32i1jfwO60Sce?type=png"></a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-4b40b8f3a9fde137d7b53e3793fc482c">ASIO</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2024-07-31" class="text-body-secondary">2024年07月31日</time>
        
	</div>
	<h2 id="a-introduction"><strong>A. Introduction</strong><a class="td-heading-self-link" href="#a-introduction" aria-label="Heading self-link"></a></h2><p>其实张佩的文章已经写得很详细了，但是如果没有任何概念的时候，还是会被众多的经典概念绕晕。 所以我的方法是：先去steinberg的forum去看一些英文原版的介绍， 然后去下载asio 的sdk下来看文档，看代码，跑代码 下载cubase下来，验证asio驱动。</p>
<h2 id="b-concepts"><strong>B. Concepts</strong><a class="td-heading-self-link" href="#b-concepts" aria-label="Heading self-link"></a></h2><h3 id="a-structure-各层的结构">a. Structure 各层的结构<a class="td-heading-self-link" href="#a-structure-%e5%90%84%e5%b1%82%e7%9a%84%e7%bb%93%e6%9e%84" aria-label="Heading self-link"></a></h3><h4 id="1-应用程序">1.应用程序<a class="td-heading-self-link" href="#1-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f" aria-label="Heading self-link"></a></h4><p>（cubase、dorico、nuendo、wavelab等都是被明确指出需要ASIO driver的）</p>
<h4 id="2-操作系统-用户空间-windows">2.操作系统-用户空间-windows<a class="td-heading-self-link" href="#2-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f-%e7%94%a8%e6%88%b7%e7%a9%ba%e9%97%b4-windows" aria-label="Heading self-link"></a></h4><p>windows驱动</p>
<p>Steinberg built-in ASIO Driver（win10 x64 &amp; win11 only）</p>
<p>早期是Generic Low Latency ASIO Driver</p>
<p>第三方的ASIO4ALL- from Michael Tippach</p>
<h4 id="3-操作系统-内核空间-windows">3.操作系统-内核空间-windows<a class="td-heading-self-link" href="#3-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f-%e5%86%85%e6%a0%b8%e7%a9%ba%e9%97%b4-windows" aria-label="Heading self-link"></a></h4><h4 id="4-硬件层">4.硬件层<a class="td-heading-self-link" href="#4-%e7%a1%ac%e4%bb%b6%e5%b1%82" aria-label="Heading self-link"></a></h4><p>ASIO是需要声卡硬件支持的 其实关于这一点，暂时还没有确定的答案，硬件上做什么样特殊的处理吗？ 但是走到操作系统的内核空间层，windows内核需要为ASIO这样一个第三方的公司定制一些特殊的模块，就像Linux那样，驱动目录下有各个不同厂商单独的文件夹。 从理论上来看，当然是可能的。但是好像还没有看到ASIO有任何这方面的资料。 如果在内核空间，所有的驱动模块都是通用的，即与AC97、Realtek等声卡所调用的驱动模块是完全一致的，那么ASIO就并不需要硬件支持了。 用另一个方式来说，ASIO的特殊之处是在用户空间的驱动里，不论是WDM还是其他windows的库，ASIO推出一套标准，用不同的方法去调用内核空间给用户空间的API。 它只是在用不同的方式或逻辑调用相同的内核API，与内核通信而已。</p>
<h2 id="c-asio-sdk"><strong>C. ASIO SDK</strong><a class="td-heading-self-link" href="#c-asio-sdk" aria-label="Heading self-link"></a></h2><h3 id="a-asio-api试图提供的性能-from-asio-sdk-2-3">a. ASIO API试图提供的性能(From ASIO SDK 2.3)<a class="td-heading-self-link" href="#a-asio-api%e8%af%95%e5%9b%be%e6%8f%90%e4%be%9b%e7%9a%84%e6%80%a7%e8%83%bd-from-asio-sdk-2-3" aria-label="Heading self-link"></a></h3><h4 id="1-high-data-throughput"><code>1.High data throughput</code><a class="td-heading-self-link" href="#1-high-data-throughput" aria-label="Heading self-link"></a></h4><pre tabindex="0"><code>PCI 

firewire
</code></pre><h4 id="2-synchronization"><code>2.synchronization</code><a class="td-heading-self-link" href="#2-synchronization" aria-label="Heading self-link"></a></h4><h4 id="3-low-latency"><code>3.low latency</code><a class="td-heading-self-link" href="#3-low-latency" aria-label="Heading self-link"></a></h4><h4 id="4-extensibility-on-the-audio-hardware"><code>4.extensibility on the audio hardware </code><a class="td-heading-self-link" href="#4-extensibility-on-the-audio-hardware" aria-label="Heading self-link"></a></h4><h4 id="5-no-limitation-on-the-number-of-i-o-channels"><code>5.no limitation on the number of i/o channels </code><a class="td-heading-self-link" href="#5-no-limitation-on-the-number-of-i-o-channels" aria-label="Heading self-link"></a></h4><h4 id="6-no-limitation-on-the-sample-rate"><code>6.no limitation on the sample rate</code><a class="td-heading-self-link" href="#6-no-limitation-on-the-sample-rate" aria-label="Heading self-link"></a></h4><pre tabindex="0"><code>32khz

96khz

higher
</code></pre><h4 id="7-no-limitation-on-sample-format"><code>7.no limitation on sample format</code><a class="td-heading-self-link" href="#7-no-limitation-on-sample-format" aria-label="Heading self-link"></a></h4><pre tabindex="0"><code>16

24

32 bit

32/64 bit floating point formats
</code></pre><h2 id="d-conclusion"><strong>D. Conclusion</strong><a class="td-heading-self-link" href="#d-conclusion" aria-label="Heading self-link"></a></h2><p>今天一天，到下午四点的时候，终于用cubase试验了自己修改过的asio driver。</p>
<p>虽然看起来很简单，但是其实是要仔细的去看asio sdk 2.3的整个包里面的文档。</p>
<p>市面上对于asio驱动、支持asio声卡、asio 硬件等概念的介绍并没有特别有针对性的。</p>
<p>asio应该理解为一种协议，cubase这类的软件都只识别这种协议的音频设备。</p>
<p>它并没有太神奇的地方，就是在软件层面的一种封装罢了。</p>
<h2 id="e-appendix"><strong>E. Appendix</strong><a class="td-heading-self-link" href="#e-appendix" aria-label="Heading self-link"></a></h2><p><a href="https://zhuanlan.zhihu.com/p/518363836">01. [***]在逃技术百晓声-ASIO、WDM和MME驱动的区别(一个比较简练的介绍)</a></p>
<p><a href="https://potterwhite.github.io/blog/2024/07/31/asio/info@steinberg.de">02. [**]Steinberg Email:info@steinberg.de</a></p>
<p><a href="https://forums.steinberg.net/c/developer/103/none?_gl=1*107pk2r*_gcl_au*MjI0MDkyMTc2LjE3MjE5ODY2MDQ.">03. [***]Steinberg Forum</a></p>
<p><a href="https://debug.fanzheng.org/post/use-cubase-without-independent-sound-card.html">04. [**]无独立声卡玩转Cubase</a></p>
<p><a href="https://blog.csdn.net/blog_index/article/details/2537080?spm=1001.2014.3001.5502">05. [仔细的介绍 *****]张佩的文章-ASIO音频驱动开发指南</a></p>
<p><a href="https://blog.csdn.net/blog_index/article/details/5411694?spm=1001.2014.3001.5502">06. [仔细的介绍 *****]张佩的文章-ASIO音频驱动开发指南 2.0</a></p>
<p><a href="https://helpcenter.steinberg.de/hc/en-us/articles/17863730844946-Steinberg-built-in-ASIO-Driver-information-download">07. Steinberg built-in ASIO Driver: information &amp; download</a></p>
<p><a href="https://helpcenter.steinberg.de/hc/en-us/articles/206111444-Audio-card-latency">08. Audio card latency</a></p>
<p><a href="https://www.buckhorn.com.cn/index.php/support-zh/tech-doc-zh/43-asio-infrastructure-zh">09. 跳羚科技 - Buckhorn之音频asio驱动开发</a></p>
<p><a href="http://www.cymount.com/news/shownews.php?id=66">10. 什么是 ASIO 声卡驱动？</a></p>
<p><a href="http://www.cymount.com/news/shownews.php?id=80">11. WASAPI介绍</a></p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-5637ca4afd986b1e0d9ae4793487f985">声卡项目</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2024-07-11" class="text-body-secondary">2024年07月11日</time>
        
	</div>
	<!-- <script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script> -->
<!-- ![_EnumerateAudioEndpoints](/2024/July/17/flowchart_of_EnumerateEndpoint.svg) -->
<h1 id="一-介绍">一、介绍<a class="td-heading-self-link" href="#%e4%b8%80-%e4%bb%8b%e7%bb%8d" aria-label="Heading self-link"></a></h1><p>这本身是一个跨操作系统的项目，但是windows是客户群体最多的一个平台，所以主力是开发win下</p>
<h1 id="二-主要的函数">二、主要的函数<a class="td-heading-self-link" href="#%e4%ba%8c-%e4%b8%bb%e8%a6%81%e7%9a%84%e5%87%bd%e6%95%b0" aria-label="Heading self-link"></a></h1><details>
    <summary>流程图1 _EnumerateAudioEndpoints</summary>
<!-- ![_EnumerateAudioEndpoints](/2024/July/11/soundcard_flow_1.svg) -->
<p>this is the first operation of our process</br>
A. and it start with CoCreateInstance() to create object of <code>IMMDeviceEnumerator</code></br>
B. then if success, use <code>IMMDeviceEnumerator.EnumAudioEndpoint()</code> to enumerate all endpoints(actually include all input &amp; output devices, but API can choose i or o or both devices) in this machine.</br>
C. if there exist endpoint, to check the number of endpoints with <code>IMMDeviceCollection.GetCount()</code>.</br>
D. use for loop to enum every endpoint, retrieve its data with <code>IMMDeviceCollection.Item()</code></br>
E. finally, if retrieving process runs smoothly and there is data who came with Item() operation, push it into endpoint global data pool.</br></p>
<!-- <object type="image/svg+xml" data="/2024/July/17/flowchart_of_EnumerateEndpoint.svg" style="width: 100%; height: 1000%;">
    Your browser does not support SVG
</object> -->
<iframe src="/2024/July/17/flow_no_zoom.svg" width="900" height="2000" style="border:none; overflow:scroll; background: #333333;">
</iframe>
<!-- ![_EnumerateAudioEndpoints](/2024/July/17/flowchart_of_EnumerateEndpoint.svg) -->
</details>
<details>
    <summary> 001. 创建com的对象 CoCreateInstance </summary>
<div style="padding-left: 2em;">
</br>
<pre tabindex="0"><code>_Check_return_
WINOLEAPI
CoCreateInstance(
    _In_ REFCLSID rclsid,
    _In_opt_ LPUNKNOWN pUnkOuter,
    _In_ DWORD dwClsContext,
    _In_ REFIID riid,
    _COM_Outptr_ _At_(*ppv, _Post_readable_size_(_Inexpressible_(varies))) LPVOID  FAR * ppv
);
</code></pre></br>
<h3 id="refrence"><strong>Refrence</strong><a class="td-heading-self-link" href="#refrence" aria-label="Heading self-link"></a></h3><p><a href="https://learn.microsoft.com/en-us/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance">1. CoCreateInstance MS Learning</a></br>
<a href="https://developer.aliyun.com/article/48371">2. COM basic tutorial</a></br></p>
</br>
<h3 id="introduce"><strong>Introduce</strong><a class="td-heading-self-link" href="#introduce" aria-label="Heading self-link"></a></h3><p><strong>CoCreateInstance</strong> is used for instance of object creating in local machine.
<strong>CoCreateInstanceEx</strong> is used for instance of object creating in REMOTE machine.
<strong>CoGetClassObject</strong> is used for MULTI instances of object creating in local machine.
CoCreateInstance encapsulates the CoGetClassObject in the low-level.
CoCreateInstance connects the object with the ID.
</br></br></p>
<h3 id="requirement"><strong>Requirement</strong><a class="td-heading-self-link" href="#requirement" aria-label="Heading self-link"></a></h3><table>
<thead>
<tr>
<th>Type</th>
<th>Name</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Library</td>
<td>Ole32.lib</td>
<td></td>
</tr>
<tr>
<td>Dynamic Link Library</td>
<td>Ole32.dll</td>
<td></td>
</tr>
<tr>
<td>Header file</td>
<td>combaseapi.h</td>
<td></td>
</tr>
<tr>
<td></td>
<td>...\Windows Kits\10\Include\10.0.22621.0\shared\guiddef.h</td>
<td>REFCLSID &amp; IID definition</td>
</tr>
<tr>
<td></td>
<td>...\Windows Kits\10\Include\10.0.22621.0\um\mmdeviceapi.h</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Minimum System Version</td>
<td>Windows 2000 and above</td>
<td></td>
</tr>
</tbody>
</table>
<p></br></br></p>
<h3 id="parameters"><strong>Parameters</strong><a class="td-heading-self-link" href="#parameters" aria-label="Heading self-link"></a></h3><p><span style="background-color: gray;">(1/5)[in] rclsid</span></br>
</br></p>
<div style="padding-left: 2em;">
The CLSID associated with the data and code that will be used to create the object.</br>
<p>REFCLSID:</br>
REF=Reference</br>
CLS=Class</br>
ID=Identifier</br>
REFCLSID rclsid：是 const CLSID&amp; 的别名，表示对 CLSID 的引用。这样传递参数时，不需要复制整个 CLSID 对象，只需要传递它的引用，从而提高效率。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#080;font-style:italic">/*mmdeviceapi.h
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * here is the definition of MMDevice Enumerator
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * we are using &#34;__uuidof(MMDeviceEnumerator)&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#080">#ifdef __cplusplus
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span>class <span style="color:#00a000">DECLSPEC_UUID</span>(<span style="color:#b44">&#34;BCDE0395-E52F-467C-8E3D-C4579291692E&#34;</span>)
</span></span><span style="display:flex;"><span>MMDeviceEnumerator;
</span></span><span style="display:flex;"><span><span style="color:#080">#endif
</span></span></span></code></pre></div><details>
    <summary>UUID为什么有中间的“-”连字符</summary>
    UUID（Universally Unique Identifier）或 GUID（Globally Unique Identifier）中使用连字符（`-`）是为了增加可读性和标准化。虽然连字符没有任何技术上的必要性，但它们有助于分隔和识别 UUID 的不同部分。
<h3 id="uuid-格式">UUID 格式<a class="td-heading-self-link" href="#uuid-%e6%a0%bc%e5%bc%8f" aria-label="Heading self-link"></a></h3><p>一个标准的 UUID 格式为 8-4-4-4-12，即总共 32 个十六进制字符分为五个部分，每个部分用连字符分隔。这种格式定义在 RFC 4122 中。</p>
<p>例如：</p>
<pre tabindex="0"><code>BCDE0395-E52F-467C-8E3D-C4579291692E
</code></pre><h3 id="格式的分隔意义">格式的分隔意义<a class="td-heading-self-link" href="#%e6%a0%bc%e5%bc%8f%e7%9a%84%e5%88%86%e9%9a%94%e6%84%8f%e4%b9%89" aria-label="Heading self-link"></a></h3><ol>
<li><strong>时间戳部分（8个字符）</strong>：UUID 的前 8 个字符通常表示时间戳的高位部分。</li>
<li><strong>时间戳的中间部分（4个字符）</strong>：接下来的 4 个字符表示时间戳的中间部分。</li>
<li><strong>时间戳的低位部分和版本号（4个字符）</strong>：接下来的 4 个字符表示时间戳的低位部分和版本号。</li>
<li><strong>时钟序列（4个字符）</strong>：接下来的 4 个字符表示时钟序列。</li>
<li><strong>节点（12个字符）</strong>：最后的 12 个字符表示节点信息（通常是基于网络地址）。</li>
</ol>
<p>这种分隔方式有助于解析和理解 UUID 的不同部分，并确保它们的唯一性。</p>
<h3 id="使用连字符的好处">使用连字符的好处<a class="td-heading-self-link" href="#%e4%bd%bf%e7%94%a8%e8%bf%9e%e5%ad%97%e7%ac%a6%e7%9a%84%e5%a5%bd%e5%a4%84" aria-label="Heading self-link"></a></h3><ol>
<li><strong>可读性</strong>：连字符使得 UUID 更加可读，更容易分辨和检查。</li>
<li><strong>标准化</strong>：按照 RFC 4122 标准定义的格式，有助于在不同系统和平台之间保持一致性。</li>
<li><strong>解析和验证</strong>：连字符分隔使得解析和验证 UUID 更加简单和明确。</li>
</ol>
<h3 id="无连字符表示">无连字符表示<a class="td-heading-self-link" href="#%e6%97%a0%e8%bf%9e%e5%ad%97%e7%ac%a6%e8%a1%a8%e7%a4%ba" aria-label="Heading self-link"></a></h3><p>在一些情况下，可以去掉连字符并连续地写下所有字符。例如：</p>
<pre tabindex="0"><code>BCDE0395E52F467C8E3DC4579291692E
</code></pre><p>这种形式在某些编程语言和库中也是支持的，但为了确保一致性和标准化，通常还是建议使用带有连字符的格式。</p>
<h3 id="总结">总结<a class="td-heading-self-link" href="#%e6%80%bb%e7%bb%93" aria-label="Heading self-link"></a></h3><ul>
<li><strong>连字符的作用</strong>：主要是增加可读性和标准化。</li>
<li><strong>UUID 格式</strong>：8-4-4-4-12 的格式有助于分隔和识别不同的部分。</li>
<li><strong>使用连字符的好处</strong>：使得 UUID 更加可读、标准化，便于解析和验证。</li>
</ul>
<p>尽管技术上可以省略连字符，但使用标准格式带来的可读性和一致性优势使得它成为惯用的做法。</p>
</details>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#080;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * guiddef.h
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#080">#define REFCLSID const IID &amp;
</span></span></span></code></pre></div></div>
</br>
<p><span style="background-color: gray;">(2/5)[in] pUnkOuter</span></br>
</br></p>
<div style="padding-left: 2em;">
If NULL, indicates that the object is not being created as part of an aggregate.</br>
If non-NULL, pointer to the aggregate object's IUnknown interface (the controlling IUnknown).</br>
<details>
    <summary>关于Aggregate，更详尽的解释-FromGpt4o</summary>
    在 `CoCreateInstance` 函数中，第二个参数 `pUnkOuter` 是一个指向 `IUnknown` 接口的指针，通常用于支持 COM 对象的聚合。聚合是 COM 中的一种技术，允许一个对象（外部对象）包含另一个对象（内部对象），并使内部对象的接口看起来像是外部对象的一部分。
<h3 id="参数详细解释">参数详细解释<a class="td-heading-self-link" href="#%e5%8f%82%e6%95%b0%e8%af%a6%e7%bb%86%e8%a7%a3%e9%87%8a" aria-label="Heading self-link"></a></h3><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>HRESULT <span style="color:#00a000">CoCreateInstance</span>(
</span></span><span style="display:flex;"><span>  REFCLSID rclsid,     <span style="color:#666">//</span> Class identifier (CLSID) of the object to be created
</span></span><span style="display:flex;"><span>  LPUNKNOWN pUnkOuter, <span style="color:#080;font-style:italic">// Pointer to controlling IUnknown (for aggregation)
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>  DWORD dwClsContext,  <span style="color:#080;font-style:italic">// Context in which the code that manages the newly created object will run
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>  REFIID riid,         <span style="color:#080;font-style:italic">// Interface identifier (IID) of the interface to be used to communicate with the object
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>  LPVOID <span style="color:#666">*</span>ppv          <span style="color:#080;font-style:italic">// Address of pointer variable that receives the interface pointer requested in riid
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>);
</span></span></code></pre></div><h3 id="punkouter-参数"><code>pUnkOuter</code> 参数<a class="td-heading-self-link" href="#punkouter-%e5%8f%82%e6%95%b0" aria-label="Heading self-link"></a></h3><ul>
<li><strong><code>pUnkOuter</code></strong>：指向控制未知接口（<code>IUnknown</code>）的指针。如果不使用聚合，则传递 <code>NULL</code>。在聚合的情况下，<code>pUnkOuter</code> 应该是外部对象的 <code>IUnknown</code> 指针。</li>
</ul>
<h3 id="聚合-aggregation">聚合（Aggregation）<a class="td-heading-self-link" href="#%e8%81%9a%e5%90%88-aggregation" aria-label="Heading self-link"></a></h3><p>聚合是一种将一个对象嵌入到另一个对象中的机制，使得内部对象的接口对外部对象的客户端透明。聚合在以下情况下有用：</p>
<ol>
<li><strong>对象组合</strong>：允许组合对象共享一个公共的 <code>IUnknown</code> 接口，从而表现为一个单一对象。</li>
<li><strong>对象封装</strong>：允许一个对象封装另一个对象，并公开其接口，而不暴露内部实现细节。</li>
</ol>
<h3 id="聚合的使用">聚合的使用<a class="td-heading-self-link" href="#%e8%81%9a%e5%90%88%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="Heading self-link"></a></h3><p>当你使用聚合时，外部对象将包含内部对象，并通过内部对象的接口来实现外部对象的部分功能。在这种情况下，<code>CoCreateInstance</code> 的第二个参数 <code>pUnkOuter</code> 将指向外部对象的 <code>IUnknown</code> 接口，以便内部对象可以调用外部对象的接口。</p>
<p>如果你不使用聚合，则将 <code>pUnkOuter</code> 设置为 <code>NULL</code>，表示不进行聚合。</p>
<h3 id="示例代码">示例代码<a class="td-heading-self-link" href="#%e7%a4%ba%e4%be%8b%e4%bb%a3%e7%a0%81" aria-label="Heading self-link"></a></h3><h4 id="不使用聚合">不使用聚合<a class="td-heading-self-link" href="#%e4%b8%8d%e4%bd%bf%e7%94%a8%e8%81%9a%e5%90%88" aria-label="Heading self-link"></a></h4><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>IMMDeviceEnumerator<span style="color:#666">*</span> deviceEnumerator <span style="color:#666">=</span> <span style="color:#a2f">NULL</span>;
</span></span><span style="display:flex;"><span>HRESULT hr <span style="color:#666">=</span> CoCreateInstance(
</span></span><span style="display:flex;"><span>    __uuidof(MMDeviceEnumerator),  <span style="color:#080;font-style:italic">// CLSID
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    <span style="color:#a2f">NULL</span>,                          <span style="color:#080;font-style:italic">// pUnkOuter (no aggregation)
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    CLSCTX_ALL,                    <span style="color:#080;font-style:italic">// Context
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    __uuidof(IMMDeviceEnumerator), <span style="color:#080;font-style:italic">// IID
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    (<span style="color:#0b0;font-weight:bold">void</span><span style="color:#666">**</span>)<span style="color:#666">&amp;</span>deviceEnumerator      <span style="color:#080;font-style:italic">// Interface pointer
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>);
</span></span></code></pre></div><p>在这个例子中，<code>pUnkOuter</code> 被设置为 <code>NULL</code>，表示不使用聚合。</p>
<h4 id="使用聚合">使用聚合<a class="td-heading-self-link" href="#%e4%bd%bf%e7%94%a8%e8%81%9a%e5%90%88" aria-label="Heading self-link"></a></h4><p>假设你有一个类 <code>COuter</code>，它希望包含一个内部对象 <code>CInner</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">COuter</span> <span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">public</span> IUnknown {
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#666">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-style:italic">// Implement IUnknown methods
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    HRESULT QueryInterface(REFIID riid, <span style="color:#0b0;font-weight:bold">void</span><span style="color:#666">**</span> ppv) {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span> (riid <span style="color:#666">==</span> IID_IUnknown) {
</span></span><span style="display:flex;"><span>            <span style="color:#666">*</span>ppv <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">static_cast</span><span style="color:#666">&lt;</span>IUnknown<span style="color:#666">*&gt;</span>(<span style="color:#a2f;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>            AddRef();
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">return</span> S_OK;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// Handle other interfaces
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">return</span> E_NOINTERFACE;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ULONG <span style="color:#00a000">AddRef</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> InterlockedIncrement(<span style="color:#666">&amp;</span>m_refCount);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ULONG <span style="color:#00a000">Release</span>() {
</span></span><span style="display:flex;"><span>        ULONG count <span style="color:#666">=</span> InterlockedDecrement(<span style="color:#666">&amp;</span>m_refCount);
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span> (count <span style="color:#666">==</span> <span style="color:#666">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">delete</span> <span style="color:#a2f;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">private</span><span style="color:#666">:</span>
</span></span><span style="display:flex;"><span>    ULONG m_refCount;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">// Create an instance of COuter and aggregate CInner
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>COuter<span style="color:#666">*</span> pOuter <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> COuter();
</span></span><span style="display:flex;"><span>IUnknown<span style="color:#666">*</span> pUnkOuter <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">static_cast</span><span style="color:#666">&lt;</span>IUnknown<span style="color:#666">*&gt;</span>(pOuter);
</span></span><span style="display:flex;"><span>CInner<span style="color:#666">*</span> pInner <span style="color:#666">=</span> <span style="color:#a2f">NULL</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HRESULT hr <span style="color:#666">=</span> CoCreateInstance(
</span></span><span style="display:flex;"><span>    CLSID_CInner,         <span style="color:#080;font-style:italic">// CLSID of the inner object
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    pUnkOuter,            <span style="color:#080;font-style:italic">// pUnkOuter (aggregation)
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    CLSCTX_INPROC_SERVER, <span style="color:#080;font-style:italic">// Context
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    IID_IUnknown,         <span style="color:#080;font-style:italic">// IID of the interface
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>    (<span style="color:#0b0;font-weight:bold">void</span><span style="color:#666">**</span>)<span style="color:#666">&amp;</span>pInner       <span style="color:#080;font-style:italic">// Interface pointer
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">if</span> (SUCCEEDED(hr)) {
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-style:italic">// Use pInner
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>}
</span></span></code></pre></div><p>在这个例子中，<code>pUnkOuter</code> 被设置为外部对象的 <code>IUnknown</code> 指针，以便内部对象可以进行聚合。</p>
<h3 id="总结-1">总结<a class="td-heading-self-link" href="#%e6%80%bb%e7%bb%93-1" aria-label="Heading self-link"></a></h3><ul>
<li><strong><code>pUnkOuter</code></strong> 是一个指向 <code>IUnknown</code> 接口的指针，用于支持聚合。</li>
<li><strong>聚合</strong> 允许一个对象包含另一个对象，并使内部对象的接口对外部对象的客户端透明。</li>
<li>如果不使用聚合，则将 <code>pUnkOuter</code> 设置为 <code>NULL</code>。</li>
</ul>
<p>通过理解 <code>pUnkOuter</code> 参数的用途和聚合的概念，可以更好地理解和使用 COM 编程模型中的聚合特性。</p>
</details>
</div>
</br>
<p><span style="background-color: gray;">(3/5)[in] dwClsContext</span></br></p>
<div style="padding-left: 2em;">
Context in which the code that manages the newly created object will run.</br>
The values are taken from the enumeration CLSCTX.</br>
<p><code>dwClsContext</code>:</br>
 <code>dw</code>=double world;(microsoft<code>s naming style)&lt;/br&gt; &amp;emsp;</code>Cls<code>=Class; (Class of COM object)&lt;/br&gt; &amp;emsp;</code>Context` means the environment which the object running</br></p>
<pre class="c">
    <code>
#...\Windows Kits\10\Include\10.0.22621.0\um\combaseapi.h

#define CLSCTX_ALL              (CLSCTX_INPROC_SERVER| \
                                CLSCTX_INPROC_HANDLER| \
                                CLSCTX_LOCAL_SERVER| \
                                CLSCTX_REMOTE_SERVER)
    </code>
</pre>
<p>and these macros are found in</p>
<pre class="c">
    <code>
#...\Windows Kits\10\Include\10.0.22621.0\shared\WTypesbase.h
typedef
enum tagCLSCTX
{
    CLSCTX_INPROC_SERVER	= 0x1,
    CLSCTX_INPROC_HANDLER	= 0x2,
    CLSCTX_LOCAL_SERVER	= 0x4,
    CLSCTX_INPROC_SERVER16	= 0x8,
    CLSCTX_REMOTE_SERVER	= 0x10,
    CLSCTX_INPROC_HANDLER16	= 0x20,
    CLSCTX_RESERVED1	= 0x40,
    CLSCTX_RESERVED2	= 0x80,
    CLSCTX_RESERVED3	= 0x100,
    CLSCTX_RESERVED4	= 0x200,
    CLSCTX_NO_CODE_DOWNLOAD	= 0x400,
    CLSCTX_RESERVED5	= 0x800,
    CLSCTX_NO_CUSTOM_MARSHAL	= 0x1000,
    CLSCTX_ENABLE_CODE_DOWNLOAD	= 0x2000,
    CLSCTX_NO_FAILURE_LOG	= 0x4000,
    CLSCTX_DISABLE_AAA	= 0x8000,
    CLSCTX_ENABLE_AAA	= 0x10000,
    CLSCTX_FROM_DEFAULT_CONTEXT	= 0x20000,
    CLSCTX_ACTIVATE_X86_SERVER	= 0x40000,
    CLSCTX_ACTIVATE_32_BIT_SERVER	= CLSCTX_ACTIVATE_X86_SERVER,
    CLSCTX_ACTIVATE_64_BIT_SERVER	= 0x80000,
    CLSCTX_ENABLE_CLOAKING	= 0x100000,
    CLSCTX_APPCONTAINER	= 0x400000,
    CLSCTX_ACTIVATE_AAA_AS_IU	= 0x800000,
    CLSCTX_RESERVED6	= 0x1000000,
    CLSCTX_ACTIVATE_ARM32_SERVER	= 0x2000000,
    CLSCTX_ALLOW_LOWER_TRUST_REGISTRATION	= 0x4000000,
    CLSCTX_PS_DLL	= 0x80000000
} 	CLSCTX;

    </code>
</pre>
</div>
</br>
<p><span style="background-color: gray;">(4/5)[in] riid</span></br>
</br></p>
<div style="padding-left: 2em;">
A reference to the identifier of the interface to be used to communicate with the object.</br>
</br>
<p><em>In</em> REFIID riid</br>
<code>REFIID riid</code>：</br>
是 const IID&amp; 的别名，表示对 IID 的引用。它的作用与 REFCLSID 类似。</br></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#080">#define REFIID const IID &amp;
</span></span></span></code></pre></div></div>
</br>
<p><span style="background-color: gray;">(5/5)[out] ppv</span></br>
</br></p>
<div style="padding-left: 2em;">
Address of pointer variable that receives the interface pointer requested in riid.</br>
Upon successful return, *ppv contains the requested interface pointer.</br>
Upon failure, *ppv contains NULL.</br>
</div>
</br>
<p><code>ppv</code>: Pointer to Pointer to Void</p>
</details>
</div>
<h2 id="002-immdevice-activate"><strong>002. IMMDevice::Activate</strong><a class="td-heading-self-link" href="#002-immdevice-activate" aria-label="Heading self-link"></a></h2><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>HRESULT <span style="color:#00a000">Activate</span>(
</span></span><span style="display:flex;"><span>  [in]  REFIID      iid,
</span></span><span style="display:flex;"><span>  [in]  DWORD       dwClsCtx,
</span></span><span style="display:flex;"><span>  [in]  PROPVARIANT <span style="color:#666">*</span>pActivationParams,
</span></span><span style="display:flex;"><span>  [out] <span style="color:#0b0;font-weight:bold">void</span>        <span style="color:#666">**</span>ppInterface
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><strong>Parameters Description</strong></p>
<p><code>iid</code>: interface identifier</p>
<p>Exp:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">const</span> IID IID_IAudioSessionControl2 <span style="color:#666">=</span> __uuidof(IAudioSessionControl2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">1.</span> IID_IAudioClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">2.</span> IID_IAudioEndpointVolume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">3.</span> IID_IAudioMeterInformation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">4.</span> IID_IAudioSessionManager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">5.</span> IID_IAudioSessionManager2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">6.</span> IID_IBaseFilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">7.</span> IID_IDeviceTopology
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">8.</span> IID_IDirectSound
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">9.</span> IID_IDirectSound8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">10.</span> IID_IDirectSoundCapture
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">11.</span> IID_IDirectSoundCapture8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">12.</span> IID_IMFTrustedOutput
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">13.</span> IID_ISpatialAudioClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">14.</span> IID_ISpatialAudioMetadataClient
</span></span></code></pre></div><p><code>dwClsCtx</code>: double word Class Context</p>
<p><code>pActivationParams</code>:</p>
<p><code>ppInterface</code></p>

</div>





    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="X" aria-label="X">
    <a target="_blank" rel="noopener" href="https://x.com/potter_whi3340" aria-label="X">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Stack Overflow" aria-label="Stack Overflow">
    <a target="_blank" rel="noopener" href="https://example.org/stack" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/potterwhite" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://example.org/slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024&ndash;2024
    <span class="td-footer__authors">Potter White | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">保留所有权利</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
