<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>NFS (Network File System) | </title><meta name=description content="An In-Depth Retrospective on NFS Mounting Issues & Establishing a Standard Workflow Foreword This document aims to provide a retrospective on the troubleshooting process for a persistent Connection refused error encountered when mounting an Ubuntu NFS server (Anastasia-Ubuntu) from an embedded BusyBox system (david host). The issue was ultimately resolved by adding the -o nolock mount option. This article will analyze the root cause of the failure in detail and establish a standard workflow for configuring NFS servers and clients, providing a reliable reference for future deployments."><meta property="og:url" content="https://potterwhite.github.io/en/blog/2025/07/29/nfs-network-file-system/"><meta property="og:title" content="NFS (Network File System)"><meta property="og:description" content="An In-Depth Retrospective on NFS Mounting Issues & Establishing a Standard Workflow Foreword This document aims to provide a retrospective on the troubleshooting process for a persistent Connection refused error encountered when mounting an Ubuntu NFS server (Anastasia-Ubuntu) from an embedded BusyBox system (david host). The issue was ultimately resolved by adding the -o nolock mount option. This article will analyze the root cause of the failure in detail and establish a standard workflow for configuring NFS servers and clients, providing a reliable reference for future deployments."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-07-29T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-29T00:00:00+00:00"><meta itemprop=name content="NFS (Network File System)"><meta itemprop=description content="An In-Depth Retrospective on NFS Mounting Issues & Establishing a Standard Workflow Foreword This document aims to provide a retrospective on the troubleshooting process for a persistent Connection refused error encountered when mounting an Ubuntu NFS server (Anastasia-Ubuntu) from an embedded BusyBox system (david host). The issue was ultimately resolved by adding the -o nolock mount option. This article will analyze the root cause of the failure in detail and establish a standard workflow for configuring NFS servers and clients, providing a reliable reference for future deployments."><meta itemprop=datePublished content="2025-07-29T00:00:00+00:00"><meta itemprop=dateModified content="2025-07-29T00:00:00+00:00"><meta itemprop=wordCount content="1411"><meta itemprop=keywords content="Blog,DevOps"><meta name=twitter:card content="summary"><meta name=twitter:title content="NFS (Network File System)"><meta name=twitter:description content="An In-Depth Retrospective on NFS Mounting Issues & Establishing a Standard Workflow Foreword This document aims to provide a retrospective on the troubleshooting process for a persistent Connection refused error encountered when mounting an Ubuntu NFS server (Anastasia-Ubuntu) from an embedded BusyBox system (david host). The issue was ultimately resolved by adding the -o nolock mount option. This article will analyze the root cause of the failure in detail and establish a standard workflow for configuring NFS servers and clients, providing a reliable reference for future deployments."><link rel=preload href=/scss/main.min.8d9fc392f483ddcfc12deab0c7339579a28bf9668f42018b93887d57cf8a63f4.css as=style integrity="sha256-jZ/DkvSD3c/BLeqwxzOVeaKL+WaPQgGLk4h9V8+KY/Q=" crossorigin=anonymous><link href=/scss/main.min.8d9fc392f483ddcfc12deab0c7339579a28bf9668f42018b93887d57cf8a63f4.css rel=stylesheet integrity="sha256-jZ/DkvSD3c/BLeqwxzOVeaKL+WaPQgGLk4h9V8+KY/Q=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en/><span class="navbar-brand__logo navbar-logo"><svg width="30" height="1" viewBox="0 0 100 100"><rect width="100%" height="100%" fill="none"/><text x="50%" y="50%" font-family="Times New Roman" font-weight="bold" font-size="80" text-anchor="middle" fill="#fff" dy=".35em">J</text></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/en/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=/en/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/en/portfolio/><span>Portfolio</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/blog/2025/07/29/nfsnet-file-system/>简体中文</a></li></ul></div></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c70ade2f812ca2773e2c1c4a9cb99a28.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c70ade2f812ca2773e2c1c4a9cb99a28.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/blog/2025/07/29/nfsnet-file-system/>简体中文</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-enblog-li><a href=/en/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-enblog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-enblogdevops-li><a href=/en/blog/devops/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-enblogdevops><span>DevOps</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-enblog20250729nfs-network-file-system-li><a href=/en/blog/2025/07/29/nfs-network-file-system/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-enblog20250729nfs-network-file-system><span class=td-sidebar-nav-active-item>NFS (Network File System)</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-enbloglinux-li><a href=/en/blog/linux/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-enbloglinux><span>Linux</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enblog20250725gmac-bring-up-work-flow-li><a href=/en/blog/2025/07/25/gmac-bring-up-work-flow/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-enblog20250725gmac-bring-up-work-flow><span>GMAC Bring Up Work Flow</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-enblog20250725gmac-bring-up-debug-strategies-li><a href=/en/blog/2025/07/25/gmac-bring-up-debug-strategies/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-enblog20250725gmac-bring-up-debug-strategies><span>GMAC Bring-Up Debug Strategies</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/potterwhite/blog-source/tree/main/content_root/content/en/blog/DevOps/nfs.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/potterwhite/blog-source/edit/main/content_root/content/en/blog/DevOps/nfs.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/potterwhite/blog-source/new/main/content_root/content/en/blog/DevOps?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/potterwhite/blog-source/issues/new?title=NFS%20%28Network%20File%20System%29" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/potterwhite/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id=print href=/en/blog/devops/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#foreword>Foreword</a></li><li><a href=#part-1-deep-dive-into-the-connection-refused-issue>Part 1: Deep Dive into the &ldquo;Connection refused&rdquo; Issue</a><ul><li><a href=#11-problem-description>1.1 Problem Description</a></li><li><a href=#12-the-troubleshooting-journey-ruling-out-the-usual-suspects>1.2 The Troubleshooting Journey: Ruling Out the Usual Suspects</a></li><li><a href=#13-root-cause-analysis-why--o-nolock-is-the-key>1.3 Root Cause Analysis: Why <code>-o nolock</code> is the Key?</a></li></ul></li><li><a href=#part-2-a-standard-workflow-for-nfs-setup>Part 2: A Standard Workflow for NFS Setup</a><ul><li><a href=#21-server-side-configuration---ubuntudebian-example>2.1 Server-Side Configuration - Ubuntu/Debian Example</a></li><li><a href=#22-client-side-configuration---using-the-embedded-david-as-an-example>2.2 Client-Side Configuration - Using the Embedded <code>david</code> as an Example</a></li></ul></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://potterwhite.github.io/en/categories/blog/ data-taxonomy-term=blog><span class=taxonomy-label>Blog</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://potterwhite.github.io/en/categories/devops/ data-taxonomy-term=devops><span class=taxonomy-label>DevOps</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://potterwhite.github.io/en/categories/linux/ data-taxonomy-term=linux><span class=taxonomy-label>Linux</span><span class=taxonomy-count>2</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/en/blog/devops/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/en/blog/>Blog</a></li><li class=breadcrumb-item><a href=/en/blog/devops/>DevOps</a></li><li class="breadcrumb-item active" aria-current=page>NFS (Network File System)</li></ol></nav><div class=td-content><h1>NFS (Network File System)</h1><div class="td-byline mb-4"><time datetime=2025-07-29 class=text-body-secondary>Jul 29, 2025</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://potterwhite.github.io/en/categories/blog/ data-taxonomy-term=blog><span class=taxonomy-label>Blog</span></a></li><li><a class=taxonomy-term href=https://potterwhite.github.io/en/categories/devops/ data-taxonomy-term=devops><span class=taxonomy-label>DevOps</span></a></li></ul></div><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 7 minute read &nbsp;</p></header><h1 id=an-in-depth-retrospective-on-nfs-mounting-issues--establishing-a-standard-workflow>An In-Depth Retrospective on NFS Mounting Issues & Establishing a Standard Workflow</h1><h2 id=foreword>Foreword</h2><p>This document aims to provide a retrospective on the troubleshooting process for a persistent <code>Connection refused</code> error encountered when mounting an Ubuntu NFS server (<code>Anastasia-Ubuntu</code>) from an embedded BusyBox system (<code>david</code> host). The issue was ultimately resolved by adding the <code>-o nolock</code> mount option. This article will analyze the root cause of the failure in detail and establish a standard workflow for configuring NFS servers and clients, providing a reliable reference for future deployments.</p><hr><h2 id=part-1-deep-dive-into-the-connection-refused-issue>Part 1: Deep Dive into the &ldquo;Connection refused&rdquo; Issue</h2><h3 id=11-problem-description>1.1 Problem Description</h3><p>When attempting to mount a shared directory from an NFS server (<code>192.168.3.164</code>) on an embedded client (<code>david</code>) using standard commands, the operation consistently failed with a <code>Connection refused</code> error, even after multiple syntax corrections.</p><p><strong>Key Log of the Failure:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>root@david:/mnt<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#8f5902;font-style:italic># mount -t nfs 192.168.3.164:/mnt/nfs/rv1126 /mnt/nfs</span>
</span></span><span style=display:flex><span>mount: mounting 192.168.3.164:/mnt/nfs/rv1126 on /mnt/nfs failed: Connection refused
</span></span></code></pre></div><p>However, upon adding the <code>-o nolock</code> option, the mount operation succeeded immediately.</p><p><strong>Log of the Successful Mount:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>root@david:/mnt<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#8f5902;font-style:italic># mount -t nfs 192.168.3.164:/mnt/nfs/rv1126 -o nolock /mnt/nfs</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>root@david:/mnt<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#8f5902;font-style:italic># df -h</span>
</span></span><span style=display:flex><span>Filesystem                Size      Used Available Use% Mounted on
</span></span><span style=display:flex><span>/dev/root                 2.9G    751.8M      2.1G  26% /
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>192.168.3.164:/mnt/nfs/rv1126
</span></span><span style=display:flex><span>                        453.2G    236.4G    193.8G  55% /mnt/nfs
</span></span></code></pre></div><h3 id=12-the-troubleshooting-journey-ruling-out-the-usual-suspects>1.2 The Troubleshooting Journey: Ruling Out the Usual Suspects</h3><p>Before identifying <code>-o nolock</code> as the solution, we conducted an exhaustive investigation, systematically eliminating all common causes of NFS failures.</p><ul><li><strong>NFS Service on the Server</strong>: By running <code>rpcinfo -p localhost</code> on the server, we confirmed that NFS v3, NFS v4, and the <code>mountd</code> service were all running correctly and listening on the network ports.
<strong>Key Log Evidence</strong>:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>james@Anastasia-Ubuntu:~$ rpcinfo -p localhost
</span></span><span style=display:flex><span>   program vers proto   port  service
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>100005</span>    <span style=color:#0000cf;font-weight:700>3</span>   tcp  <span style=color:#0000cf;font-weight:700>13025</span>  mountd
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>100003</span>    <span style=color:#0000cf;font-weight:700>3</span>   tcp   <span style=color:#0000cf;font-weight:700>2049</span>  nfs
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>100003</span>    <span style=color:#0000cf;font-weight:700>4</span>   tcp   <span style=color:#0000cf;font-weight:700>2049</span>  nfs
</span></span><span style=display:flex><span>   ...
</span></span></code></pre></div></li><li><strong>Server Firewall</strong>: The <code>sudo ufw status</code> command confirmed the firewall was <code>inactive</code>, meaning no network traffic was being blocked.</li><li><strong>Server Export Configuration (<code>/etc/exports</code>)</strong>: We verified that the shared directory was correctly exported to all clients (<code>*</code>) and that the <code>insecure</code> option was added for compatibility with embedded devices.</li><li><strong>Client Kernel Support</strong>: By running <code>cat /proc/filesystems</code> on the client, we confirmed that the kernel was compiled with <code>nfs</code> filesystem support.
<strong>Key Log Evidence</strong>:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>root@david:/root<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#8f5902;font-style:italic># cat /proc/filesystems</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>nodev   nfs
</span></span><span style=display:flex><span>...
</span></span></code></pre></div></li><li><strong>Client Functionality Integrity</strong>: A decisive clue was that the &ldquo;client <code>david</code> could successfully mount NFS shares from other PCs,&rdquo; proving that the client&rsquo;s own NFS functionality was not at fault.</li></ul><p>All standard checks indicated a &ldquo;perfectly normal&rdquo; setup, yet the problem persisted. This forced us to shift our focus to the deeper, more subtle details of the NFS protocol.</p><h3 id=13-root-cause-analysis-why--o-nolock-is-the-key>1.3 Root Cause Analysis: Why <code>-o nolock</code> is the Key?</h3><p><strong>The root cause was a communication failure between the client and server regarding the &ldquo;file locking&rdquo; feature.</strong></p><ol><li><p><strong>File Locking Mechanism</strong>:
To ensure data consistency when multiple clients access the same file, the NFS protocol implements a file locking mechanism. This mechanism relies on a separate protocol known as <strong>NLM (Network Lock Manager)</strong>. A standard NFS mount process involves not only establishing a data transfer channel but also requires the client to perform a &ldquo;handshake&rdquo; with the server&rsquo;s lock manager service (<code>nlockmgr</code>) to handle future file lock requests.</p></li><li><p><strong>Client&rsquo;s Missing Functionality</strong>:
Our client, <code>david</code>, is a highly stripped-down BusyBox system. To minimize its footprint, its NFS client implementation likely includes <strong>only the core data read/write functionality, while the complete NLM file locking client module has been omitted</strong>.</p></li><li><p><strong>The Failed &ldquo;Handshake&rdquo;</strong>:
When <code>david</code> attempted to mount, it followed the standard procedure. After the data channel was established, it tried to communicate with the server&rsquo;s <code>nlockmgr</code> service. However, due to its incomplete functionality, the request it sent was likely malformed or unrecognizable to the server. The server&rsquo;s RPC system, upon receiving this invalid request, could not process it and therefore <strong>actively refused the connection (<code>Connection refused</code>)</strong>, causing the entire mount operation to fail.</p></li><li><p><strong>The Role of <code>-o nolock</code></strong>:
This option is an instruction to the client&rsquo;s kernel: &ldquo;<strong>For this mount, completely disable the NLM file locking protocol.</strong>&rdquo; Upon receiving this directive, the kernel <strong>skips</strong> the step of communicating with the server&rsquo;s <code>nlockmgr</code> service. Because this guaranteed-to-fail step was bypassed, the rest of the mount process completed smoothly, resulting in a successful mount.</p></li></ol><p><strong>Conclusion</strong>: The <code>Connection refused</code> error did not stem from a network or permission issue, but rather from the stripped-down embedded client&rsquo;s inability to complete the &ldquo;file lock negotiation&rdquo; step of the standard NFS mount procedure, leading to rejection by the fully-featured server. The <code>-o nolock</code> option is the key to resolving such mount failures caused by incomplete client functionality.</p><hr><h2 id=part-2-a-standard-workflow-for-nfs-setup>Part 2: A Standard Workflow for NFS Setup</h2><p>The following workflow is designed to provide a reliable and reproducible process for setting up an NFS environment, with special considerations for using embedded devices as clients.</p><h3 id=21-server-side-configuration---ubuntudebian-example>2.1 Server-Side Configuration - Ubuntu/Debian Example</h3><h4 id=step-1-install-nfs-services>Step 1: Install NFS Services</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install nfs-kernel-server
</span></span></code></pre></div><h4 id=step-2-create-and-prepare-the-shared-directory>Step 2: Create and Prepare the Shared Directory</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Example: Create a shared directory named nfs_share</span>
</span></span><span style=display:flex><span>sudo mkdir -p /mnt/nfs_share
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Assign permissive ownership to ensure client access</span>
</span></span><span style=display:flex><span>sudo chown nobody:nogroup /mnt/nfs_share
</span></span><span style=display:flex><span>sudo chmod <span style=color:#0000cf;font-weight:700>777</span> /mnt/nfs_share
</span></span></code></pre></div><h4 id=step-3-configure-the-exports-file-etcexports-core-step>Step 3: Configure the Exports File <code>/etc/exports</code> (Core Step)</h4><p>Open <code>/etc/exports</code> with a text editor:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /etc/exports
</span></span></code></pre></div><p>Add a line to define the sharing rule. The following is a recommended configuration that is highly compatible and suitable for development environments:</p><div class=chem>$$/mnt/nfs_share *(rw,sync,no_subtree_check,no_root_squash,insecure)$$</div><p><strong>Options Explained & Notes:</strong></p><ul><li><code>/mnt/nfs_share</code>: The <strong>absolute path</strong> of the directory to be shared.</li><li><code>*</code>: Allows access from any IP address. For better security, this can be replaced with a specific subnet, e.g., <code>192.168.3.0/24</code>.</li><li><code>rw</code>: Allows read and write operations.</li><li><code>sync</code>: Writes data synchronously (as opposed to <code>async</code>), which is safer and less prone to data loss.</li><li><code>no_subtree_check</code>: Disables subtree checking, which can improve performance and reliability.</li><li><code>no_root_squash</code>: Allows the <code>root</code> user on the client to have <code>root</code> privileges on the mount point. <strong>This is crucial for embedded development and debugging.</strong></li><li><strong><code>insecure</code></strong>: <strong>[Note 1: Critical for Embedded Device Compatibility]</strong> Allows connections from clients using non-privileged ports (>1024). Many stripped-down embedded NFS clients cannot use privileged ports, and <strong>the absence of this option is a common cause of <code>Connection refused</code> errors.</strong></li></ul><h4 id=step-4-apply-the-configuration>Step 4: Apply the Configuration</h4><p>After every modification to <code>/etc/exports</code>, you must run this command to refresh the configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo exportfs -ra
</span></span></code></pre></div><p>To ensure all services are updated, you can also restart the NFS service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart nfs-kernel-server
</span></span></code></pre></div><h4 id=step-5-check-the-firewall-if-active>Step 5: Check the Firewall (If Active)</h4><p>If the server&rsquo;s firewall (<code>ufw</code>) is active, you need to add an inbound rule:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check status</span>
</span></span><span style=display:flex><span>sudo ufw status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Allow NFS connections from the entire local network (recommended)</span>
</span></span><span style=display:flex><span>sudo ufw allow from 192.168.3.0/24 to any port nfs
</span></span></code></pre></div><h3 id=22-client-side-configuration---using-the-embedded-david-as-an-example>2.2 Client-Side Configuration - Using the Embedded <code>david</code> as an Example</h3><h4 id=step-1-verify-basic-client-capabilities>Step 1: Verify Basic Client Capabilities</h4><p>Before mounting, perform a quick diagnosis to ensure prerequisites are met.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check if the kernel supports NFS</span>
</span></span><span style=display:flex><span>cat /proc/filesystems <span style=color:#000;font-weight:700>|</span> grep nfs
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Expected output should include a line with &#34;nfs&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Check network connectivity</span>
</span></span><span style=display:flex><span>ping &lt;server_ip_address&gt;
</span></span></code></pre></div><h4 id=step-2-create-a-local-mount-point>Step 2: Create a Local Mount Point</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /mnt/server_share
</span></span></code></pre></div><h4 id=step-3-execute-the-mount-command-core-step>Step 3: Execute the Mount Command (Core Step)</h4><p>Use the full command with compatibility options to perform the mount:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount -t nfs -o <span style=color:#000>nfsvers</span><span style=color:#ce5c00;font-weight:700>=</span>3,nolock &lt;server_ip&gt;:&lt;absolute_path_on_server&gt; &lt;local_mount_point&gt;
</span></span></code></pre></div><p><strong>Specific Example:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount -t nfs -o <span style=color:#000>nfsvers</span><span style=color:#ce5c00;font-weight:700>=</span>3,nolock 192.168.3.164:/mnt/nfs_share /mnt/server_share
</span></span></code></pre></div><p><strong>Options Explained & Notes:</strong></p><ul><li><code>-t nfs</code>: Explicitly specifies the filesystem type as NFS.</li><li><code>-o nfsvers=3</code>: <strong>[Note 2: Critical for Embedded Device Compatibility]</strong> Explicitly specifies the use of the NFSv3 protocol. Embedded clients may have incomplete support for the more complex NFSv4 protocol; forcing v3 can prevent many authentication and protocol negotiation issues.</li><li><code>-o nolock</code>: <strong>[Note 3: Critical for Embedded Device Compatibility]</strong> Disables the file locking (NLM) protocol. As demonstrated in this retrospective, stripped-down clients may lack NLM functionality, and <strong>this option is the ultimate solution for resolving <code>Connection refused</code> errors caused by a failed lock negotiation.</strong></li></ul><h4 id=step-4-verify-the-mount>Step 4: Verify the Mount</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 1. Check the list of mounted filesystems</span>
</span></span><span style=display:flex><span>df -h
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># or</span>
</span></span><span style=display:flex><span>mount
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 2. Check if you can read/write files</span>
</span></span><span style=display:flex><span>ls /mnt/server_share
</span></span><span style=display:flex><span>touch /mnt/server_share/test_file_from_david
</span></span></code></pre></div><h4 id=step-5-configure-automatic-mounting-on-boot-optional>Step 5: Configure Automatic Mounting on Boot (Optional)</h4><p>To have the device mount the share automatically at boot, edit the <code>/etc/fstab</code> file.
<strong>Warning</strong>: On embedded systems, <code>/etc/fstab</code> may not exist or may be on a read-only partition. Proceed with caution.</p><div class=chem>$$# <server_ip>:<share_path> <local_mount_point>nfs <options>0 0
192.168.3.164:/mnt/nfs_share /mnt/server_share nfs nfsvers=3,nolock,auto,bg 0 0$$</div><ul><li><code>auto</code>: Mount automatically at system startup.</li><li><code>bg</code>: If the initial mount fails (e.g., network not ready), retry in the background. This is very useful for embedded devices.</li></ul><hr><p><strong>END</strong></p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a class="btn btn-primary disabled"><span class=me-1>←</span>Previous</a></li><li><a class="btn btn-primary disabled">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=X aria-label=X><a target=_blank rel=noopener href=https://x.com/potter_whi3340 aria-label=X><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Hugging Face" aria-label="Hugging Face"><a target=_blank rel=noopener href=https://huggingface.co/PotterWhite aria-label="Hugging Face"><i class="fab fa-robot"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/potterwhite aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://zadoktec.slack.com aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2025
<span class=td-footer__authors>Potter White | <a href=https://creativecommons.org/licenses/by/4.0 target=_blank rel=noopener>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><link rel=stylesheet href=/css/katex.min.css integrity="sha512-fn414+8Ct7Q3RJpEyj+sYuwe05y4MStoCgD+isYLrclbBjtpRja4RAhW9/Xowsyeaw77WBF5smVsfh6XVYxwlg==" crossorigin=anonymous><script defer src=/js/katex.min.js integrity="sha512-yt1Fwa8fRL2vGW3JsQTx2uspBD8NxZFV/+IoR1EKBDkKC3qFlADUIKYmIE9/xd2wfBkxHeHGayXhnCVZ0+EmqA==" crossorigin=anonymous></script><script defer src=/js/mhchem.min.js integrity="sha512-Cl4bz7Rt9ppgcBOQa4z96q3UqAzHgBzNDm66u2+lDe0ZJQu0Fgz+6jO57E+IZqzlhGzfNBY++pg7Ue+iopaLrg==" crossorigin=anonymous></script><script defer src=/js/auto-render.min.js integrity="sha512-6bKDPShiPRjAcdeO8T6cedaVEi0pavPbzue/G/ZRiwVlurWZOSZ/vI9fr2lhk8IPXK7z51AZac+zBvZzgDJzDQ==" crossorigin=anonymous onload=renderMathInElement(document.body,null)></script><script src=/js/main.min.c7cf76e0360e19b696291ec124be8f05e7d46230f8031e081350143806af8320.js integrity="sha256-x8924DYOGbaWKR7BJL6PBefUYjD4Ax4IE1AUOAavgyA=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>